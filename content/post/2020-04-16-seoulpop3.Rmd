---
title: 서울시 생활인구 데이터 분석3 [데이터 분석] 
author: JDW
date: '2020-04-16'
slug: seoulpop3
categories:
  - 데이터분석
tags:
  - R
---
```{r, message=FALSE, include=FALSE}

library(dplyr)
library(stringr)
library(XML)
library(xml2)
library(lubridate)
library(zoo)
library(ggplot2)

seouldata <- readRDS('C:/Users/JDW/OneDrive - aggregate distributed infrastructures/r_programming/PROJECT/pop/seoul_footTrafic.rds')
sum_seouldata <- seouldata %>% filter(JACHIGU == '합계')
seouldata <- seouldata %>% filter(JACHIGU != '합계')
```

![](/post/2020-04-16-seoulpop3_files/seoul-410264_1920.jpg)

&nbsp; 지금까지 서울시에서 제공하는 공공데이터인 서울시 주민등록 인구 통계 데이터를 호출하여 전처리하는 과정까지 진행하였습니다. 분석의 마무리 과정으로 간단히 그래프를 그려 서울시 인구의 추세와 동향을 살펴보겠습니다. 
<br>

# 데이터 분석

## 데이터 호출
&nbsp; 먼저 이전 장에서 전처리한 데이터를 불러와 줍니다. 
```{r, eval = F}
sum_seouldata <- readRDS('./sum_seouldata.rds')
seouldata <- readRDS('./seouldata.rds')
```
```{r}
head(sum_seouldata); head(seouldata);
```

## 변수열 선택 
&nbsp; 불러온 데이터 중 분석에 사용할 데이터 변수열을 선택합니다. 이번에 사용할 데이터 변수들은 다음과 같습니다. 
```{r}
sum_seouldata <- sum_seouldata %>% select(
    GIGAN,                  # 연도-분기 
    JACHIGU,                # 자치구 
    SEDAE,                  # 세대 
    GYE_1,                  # 전체 인구 
    NAMJA_1,                # 남성 인구 
    YEOJA_1,                # 여성 인구 
    SEDAEDANGINGU,          # 세대당 인구 
    N_65SEISANGGORYEONGJA,  # 65세 이상 인구 (고령 인구) 
    year,                   # 연도 
    qrt,                    # 분기 
)
seouldata <- seouldata %>% select(
    GIGAN,                  # 연도-분기 
    JACHIGU,                # 자치구 
    SEDAE,                  # 세대 
    GYE_1,                  # 전체 인구 
    NAMJA_1,                # 남성 인구 
    YEOJA_1,                # 여성 인구 
    SEDAEDANGINGU,          # 세대당 인구 
    N_65SEISANGGORYEONGJA,  # 65세 이상 인구 (고령 인구) 
    year,                   # 연도 
    qrt,                    # 분기 
)

head(sum_seouldata); head(seouldata)
```
<br>


## 상관 분석 
&nbsp; 데이터 중 인구수를 의미하는 수치형 데이터들(남성인구, 여성인구 등) 간의 상관 분석을 진행합니다. 
```{r, warning=F, message=F}
# 상관분석
cor_seoul <- seouldata %>%
    select(SEDAE, GYE_1, NAMJA_1, YEOJA_1, SEDAEDANGINGU, N_65SEISANGGORYEONGJA)
cor(cor_seoul, method = 'pearson') # 피어슨 상관 계수 
```
<br>

&nbsp; 각 변수간의 상관성을 살펴보기 위해 R의 통계 내장함수 중 상관계수를 계산해주는 `cor()`함수를 사용하여 변수들의 상관성을 도출했습니다. 보통 계수가 0.7 이상이면 강한 상관관계에 있다고 볼 수 있는데요. 계산을 통해 세대당 인구를 제외한 나머지 인구 변수들간 상관성이 높다는 것을 도출할 수 있습니다.  

&nbsp; **`GGally`** 패키지의 `ggpair()`함수를 통해 상관분석의 차트를 그릴 수 있습니다. 인구변수간의 상관성을 시각화하여 살펴보도록 하겠습니다. 
```{r, warning = F, message=F, out.width="100%"}
library(GGally)
ggpairs(cor_seoul)
```
<br> 

&nbsp; 차트는 총 세가지의 범주의 정보를 포함하고 있습니다. 차트의 좌-하단부는 변수간의 산점도를 나타내고, 우-상단부엔 앞서 계산했던 변수간의 상관 계수가 표시됩니다. 중앙에는 각 변수의 분포가 그려져 이를 파악할 수 있습니다. 

&nbsp; 상관 계수를 숫자로만 보았을 때 보다 확실히 시각화를 진행하니 더욱 직관적으로 다가오는 부분이 있네요. 세대당 인구수를 제외한 나머지 변수들의 상관성이 높게 나타나는것은 물론이고, 남성인구와 여성인구의 상관성도 0.994로 1에 근접하는 굉장히 높은 수치인 걸 볼 수 있습니다. 65세 이상 인구에 있어서는 남성 인구와의 상관계수(0.789) 보다 여성 인구와의 상관계수(0.804)가 더 높은걸로 보아 고령인구에는 남자보다 여자가 더 많이 분포되어 있을 것으로 판단됩니다. 

&nbsp; 이 밖에도 R에서는 **`corrplot`**, **`PerformanceAnalytics`**등의 패키지를 통해 상관분석 그래프를 그릴 수 있습니다. 

## 인구 동향 
&nbsp; 이번에는 앞서 전처리한 데이터를 기반으로 그래프를통해 서울시의 인구의 동향을 파악해 보도록 합시다. 주로 라인 그래프를 그려 기간별 동향을 파악할 것입니다. 
<br>

### 서울시 전체 인구 
```{r, message=F, warning=F, out.width="100%"}
library(ggplot2)

# 연도별 인구
sum_seouldata %>%
    group_by(year) %>%
    summarise(mean_pop = round(mean(GYE_1), 0)) %>%
    ggplot(aes(x = year %>% as.factor(), y = mean_pop, group = 1)) +
    geom_point(color = 'red') +
    geom_line() +
    geom_text(aes(label = mean_pop), hjust = 'inward', vjust = 'inward', size = 4, angle = 15) +
    theme(title = element_text(face = 'bold', size = 25)) +
    theme(axis.text.x = element_text(angle = 45)) +
    theme(axis.title.x = element_text(size = 15)) +
    theme(axis.title.y = element_text(size = 15)) +
    labs(title = '서울시 연평균 인구수 변화 추이',
         x = '연도', y = '인구')

# 연도-분기별 인구
sum_seouldata %>%
    ggplot(aes(x = GIGAN, y = GYE_1, group = 1)) +
    geom_point(color = 'red') +
    geom_line() +
    geom_text(aes(label = GYE_1), hjust = 'inward', vjust = 'inward', size = 2, angle = 15) +
    theme(title = element_text(face = 'bold', size = 25)) +
    theme(axis.text.x = element_text(angle = 45)) +
    theme(axis.title.x = element_text(size = 15)) +
    theme(axis.title.y = element_text(size = 15)) +
    labs(title = '연도-분기별 서울시 인구수 변화 추이',
         x = '연도-분기', y = '인구수') 

sum_seouldata %>%
    mutate(tempyear = paste(year, '년')) %>%
    ggplot(aes(x = qrt %>% as.factor(), y = GYE_1, group = 1)) +
    geom_point(color = 'red') +
    geom_line() +
    geom_text(aes(label = GYE_1), hjust = 'inward', vjust = 'inward', size = 2, angle = 15) +
    theme(title = element_text(face = 'bold', size = 25)) +
    theme(axis.title.x = element_text(size = 15)) +
    theme(axis.title.y = element_text(size = 15)) +
    labs(title = '연도-분기별 서울시 인구수 변화 추이',
         x = '분기', y = '인구수') +
    facet_grid(~tempyear)

# 분기별 인구수 변화
sum_seouldata %>%
    mutate(tempqrt = paste(qrt, '분기')) %>%
    ggplot(aes(x =year %>% as.factor(), y = GYE_1, group = 1)) +
    geom_point(color = 'red') +
    geom_line() +
    geom_text(aes(label = GYE_1), hjust = 'inward', vjust = 'inward', size = 3, angle = 15) +
    theme(title = element_text(face = 'bold', size = 25)) +
    theme(axis.text.x = element_text(angle = 45)) +
    theme(axis.title.x = element_text(size = 15)) +
    theme(axis.title.y = element_text(size = 15)) +
    labs(title = '분기별 서울시 인구수 변화 추이',
         x = '연도', y = '인구수') +
    facet_grid(~tempqrt) 
```
<br> 

&nbsp; 서울의 인구는 2010년 4분기에 잠시 상승하였다가 2011년을 기점으로 지속적으로 하락하고 있는것을 확인할 수 있습니다. 경제성장의 둔화, 라이프 스타일의 변화 같은 요인으로 인한 인구의 감소일까요? 추측은 할 수 있어도 이를 뒷받침할 근거가 없기 때문에 섣불리 판단할 수는 없을 것 같습니다. 서울의 인구하락의 요인이 무엇일지 문득 궁금증이 생기네요. 

다음으로 성별에 따른 동향을 살펴보겠습니다. 
<br>

### 성별간 인구 동향 
```{r, warning=F, message=F, out.width="100%"}
library(reshape2)
# 성별간 인구 
sum_seouldata %>%
    select(GIGAN, NAMJA_1, YEOJA_1) %>%
    reshape2::melt(id.vars = c('GIGAN')) %>%
    ggplot(aes(x = GIGAN, y = value, group = variable)) +
    geom_line(aes(color = variable)) +
    geom_point(color = 'red') +
    geom_text(aes(label = value), hjust = 'inward', vjust = 'inward', size = 2, angle = 15) +
    theme(title = element_text(face = 'bold', size = 15)) +
    theme(axis.text.x = element_text(angle = 45, size = 7)) +
    theme(axis.title.x = element_text(size = 15)) +
    theme(axis.title.y = element_text(size = 15)) +
    scale_color_discrete("성별", labels = c('male', 'female')) +
    labs(title = '연도-분기별 서울시 성별간 인구수 변화 추이 비교 ',
         x = '연도-분기', y = '인구수') 

```
<br> 

&nbsp; 성별에 따른 인구수의 동향을 살펴보자면 앞서 상관분석에서 남성과 여성의 상관계수가 0.9 이상이였던 것을 확인 했듯이 두 성별 모두 시간에 따른 추세는 비슷해 보입니다. 하지만 그래프에서 남성의 인구가 여성보다 더욱 가파르게 하락하는 것을 볼 수 있습니다. 더불어 서울 내 여성의 인구수가 남성보다 대략 20만명 많은 것을 볼 수 있네요.    
<br>

### 고령 인구 동향 
```{r, warning=F, message=F, out.width="100%"}
# 연도별 인구
sum_seouldata %>%
    group_by(year) %>%
    summarise(mean_pop = round(mean(N_65SEISANGGORYEONGJA), 0)) %>%
    ggplot(aes(x = year %>% as.factor(), y = mean_pop, group = 1)) +
    geom_point(color = 'red') +
    geom_line() +
    geom_text(aes(label = mean_pop), hjust = 'inward', vjust = -1, size = 4, angle = 15) +
    theme(title = element_text(face = 'bold', size = 25)) +
    theme(axis.text.x = element_text(angle = 45)) +
    theme(axis.title.x = element_text(size = 15)) +
    theme(axis.title.y = element_text(size = 15)) +
    labs(title = '서울시 연평균 고령인구수 변화 추이',
         x = '연도', y = '고령인구수') 

# 연도-분기별 인구
sum_seouldata %>%
    ggplot(aes(x = GIGAN, y = N_65SEISANGGORYEONGJA, group = 1)) +
    geom_point(color = 'red') +
    geom_line() +
    geom_text(aes(label = N_65SEISANGGORYEONGJA), hjust = 'inward', vjust = 'inward', size = 2) +
    theme(title = element_text(face = 'bold', size = 20)) +
    theme(axis.text.x = element_text(angle = 45)) +
    theme(axis.title.x = element_text(size = 15)) +
    theme(axis.title.y = element_text(size = 15)) +
    labs(title = '연도-분기별 서울시 고령인구수 변화 추이',
         x = '연도-분기', y = '고령인구수') 

sum_seouldata %>%
    mutate(tempyear = paste(year, '년')) %>%
    ggplot(aes(x = qrt %>% as.factor(), y = N_65SEISANGGORYEONGJA, group = 1)) +
    geom_point(color = 'red') +
    geom_line() +
    geom_text(aes(label = N_65SEISANGGORYEONGJA), hjust = 'inward', vjust = 'inward', size = 2) +
    theme(title = element_text(face = 'bold', size = 20)) +
    theme(axis.title.x = element_text(size = 15)) +
    theme(axis.title.y = element_text(size = 15)) +
    labs(title = '연도-분기별 서울시 고령인구수 변화 추이',
         x = '연도-분기', y = '고령인구수') +
    facet_grid(~tempyear) 

# 분기별 인구수 변화
sum_seouldata %>%
    mutate(tempqrt = paste(qrt, '분기')) %>%
    ggplot(aes(x =year %>% as.factor(), y = N_65SEISANGGORYEONGJA, group = 1)) +
    geom_point(color = 'red') +
    geom_line() +
    geom_text(aes(label = N_65SEISANGGORYEONGJA), hjust = 'inward', vjust = -1, size = 3, angle = 15) +
    theme(title = element_text(face = 'bold', size = 25)) +
    theme(axis.text.x = element_text(angle = 45)) +
    theme(axis.title.x = element_text(size = 15)) +
    theme(axis.title.y = element_text(size = 15)) +
    labs(title = '분기별 서울시 고령인구수 변화 추이',
         x = '연도-분기', y = '고령인구수') +
    facet_grid(~tempqrt)  
```
<br> 

&nbsp; 65세 이상의 인구수는 시간과 상관 없이 해마다 꾸준히 증가해 오고 있었습니다. 그래프의 기울기의 변화가 거의 없는것으로 보아 증가하는 요인이 특정 기간에 있는것이 아닌것으로 보여지는데요. 전체 인구가 감소하는 와중에 65세 이상 노령인구는 증가한다는 것은 그만큼 서울에 젊은 사람들이 줄어들고 있다는 것으로 바라볼 수 있을 것 같습니다. 저출산과 고령화라는 단어가 더욱 와닿게 느껴지네요. 
<br> 

### 자치구별 변화 
```{r, warning=F, message=F, out.width="100%"}
library(scales)
library(zoo)
# 연도별 변화
seouldata %>%
    ggplot(aes(x = as.factor(year), y = GYE_1, group = 1)) +
    geom_line() +
    geom_point(color = 'red') +
    geom_text(aes(label = GYE_1), hjust = 'inward', vjust = 'inward', size = 2.5, angle = 45, check_overlap = T) +
    theme(plot.title = element_text(face = 'bold', size = 20)) +
    theme(axis.title.x = element_text(face = 'bold', size = 15)) +
    theme(axis.title.y = element_text(face = 'bold', size = 15)) +
    theme(axis.text.x = element_text( size = 10, angle = 45)) +
    scale_y_continuous(labels=scales::comma) +
    facet_wrap(~JACHIGU) +
    labs(title = '서울시 자치구별 연간 인구 변화 추이',
         x = '연도', y = '인구')

# 자치구별 인구 Boxplot
seouldata %>%
    ggplot(aes(x = JACHIGU, y = GYE_1, col = JACHIGU)) +
    geom_boxplot() + 
    theme(plot.title = element_text(face = 'bold', size = 20)) +
    theme(axis.title.x = element_text(face = 'bold', size = 15)) +
    theme(axis.title.y = element_text(face = 'bold', size = 15)) +
    theme(axis.text.x = element_text(size = 10, angle = 45)) +
    theme(legend.position = 'none') + 
    scale_y_continuous(labels=scales::comma) +
    labs(title = '서울시 자치구별 인구 Boxplot',
         x = '자치구', y = '인구')


# 연도별 변화(인구순 정렬)
seouldata$JACHIGU <- seouldata$JACHIGU %>% as.character() %>% as.factor()
popLevels <- seouldata %>%
    group_by(JACHIGU) %>%
    summarise(mean_pop = mean(GYE_1)) %>%
    arrange(desc(mean_pop)) %>%
    ungroup() %>%
    select(JACHIGU) %>%
    sapply(., function(x){as.character(x)}) %>%
    as.character()
seouldata_ordered <- arrange(transform(seouldata, JACHIGU = factor(JACHIGU, levels = popLevels)), JACHIGU)

seouldata_ordered %>%
    ggplot(aes(x = as.factor(year), y = GYE_1, group = 1)) +
    geom_line() +
    geom_point(color = 'red', size = .5) +
    theme(plot.title = element_text(face = 'bold', size = 15)) +
    theme(axis.title.x = element_text(face = 'bold', size = 10)) +
    theme(axis.title.y = element_text(face = 'bold', size = 10)) +
    theme(axis.text.y = element_text(size = 3)) + 
    theme(axis.text.x = element_text(size = 3, angle = 90)) +
    theme(strip.text.x = element_text(size = 5)) + 
    scale_y_continuous(labels=scales::comma) +
    zoo::facet_free(~JACHIGU) +
    labs(title = '서울시 자치구별 연간 인구 변화 추이 (평균인구수 기준 조정)',
         x = '연도', y = '인구') 
```
<br> 

&nbsp; 자치구별 인구수 역시 송파와 강서를 제외한 모든 지역이 하락하는 모습을 볼 수 있습니다. 인구 하락의 요인이 어느 특정 지역에 있는것이 아닌 전반적인 추세에 있다는 것을 의미하는것 같네요. 
<br> 

___

&nbsp; 지금까지 서울시 열린데이터 광장에서 제공하는 서울시 주민등록인구 통계 데이터를 다뤄 보았습니다. 분석을 통해 서울시의 인구 감소를 직접 확인하였는데요. 언론에서 말하는 인구 절벽이니 저출산 고령화 등과 같은 키워드들이 좀 더 크게 와닿게 되는것 같습니다. 이번 분석에선 인구 하락 현상에 대한 시각화를 진행하였지만, 훗날 기회가 되면 인구 하락의 여러 요인들을 수집하여 더욱 고도화된 분석을 진행해 볼까 합니다. 























































































































